<div class="container row panel-view">
    <div class="col-lg-12 panel-left">
        <div class="d-flex align-items-center justify-content-between " id="container-title" >

            <div class="container" id="loader-container-1">
                <div  class="d-flex align-items-center justify-content-start " id="preloader-1">
                    <div class="loader" id="loader-4">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            </div>
        </div>
        <br />
        <div class="">
            <div class="d-flex align-items-center justify-content-center" id="preloader-2">
                <div class="loader" id="loader-4">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            <div class="table-responsive table-wrapper-scroll-y" id="container-table">
                <table class="table table-fixed table-hover ">
                    <thead class="thead-light text-white thead">
                        <tr class="small" id="ejecution-table-tr"></tr>
                    </thead>
                    <tbody id="ejecution-table-body"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script src="~/Scripts/index.js"></script>
    <script src="~/Scripts/utils/utils.js"></script>
    <script type="text/javascript">
        $(document).ready(($) => {

            let dataEP = JSON.stringify({
                IdCampana: "17-2",
                IdCliente: "002",
                SemanaConsulta: 0,
                FlagColor: 0
            });

            axios.get(`${URLSERVER}/SCEProyeccionComercial/GetProyeccionCampo`, {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json',
                },
                params: {
                    IdCampana: JSON.parse(dataEP).IdCampana,
                    IdCliente: JSON.parse(dataEP).IdCliente,
                    SemanaConsulta: JSON.parse(dataEP).SemanaConsulta,
                    FlagColor: JSON.parse(dataEP).FlagColor
                }
            })
            .then(response => {
                if (response.data.length > 0) {
                    let th;
                    
                    let column = new Array();
                    
                    for (var key in response.data[0]) {
                        //th = th + `<th class="text-center ${key}" id=${key}>${key}</th>`;
                       

                        if (key.substr(0, 2) === "C_") {
                            let week = key.split("-").pop();
                            th = th + `<th class="text-center ${key}" id=${key}>Proyectado ${week}</th>`;
                        }
                        else if (key.substr(0, 2) === "E_") {
                            let week = key.split("-").pop();
                            th = th + `<th class="text-center ${key}" id=${key}>Ejecutado ${week}</th>`;
                        }
                        else if (key.substr(0, 2) === "D_") {
                            let week = key.split("-").pop();
                            th = th + `<th class="text-center ${key}" id=${key}>Diferencia ${week}</th>`;
                        }
                        else
                        {
                            th = th + `<th class="text-center ${key}" id=${key}>${key}</th>`;
                        }
                        column.push(key);
                    }
                    $(`#ejecution-table-tr`).append(th);

                    for (var i = 0; i < response.data.length; i++) {
                        console.log(response.data[i]);
                    }
                   
                    response.data.map((item, index) => {
                        let td = `<tr class=" small">`;
                       
                        let counter = 0;
                        for (var i in item) {

                            if (counter < 3 && counter >= 0 && i.substr(0, 2) === "C_") {
                                td = td + `<td class="text-center ${i} bg-light">${item[i]}</td>`;
                                 counter = counter + 1;
                            }
                            else if (counter < 3 && counter >= 0 && i.substr(0, 2) === "E_")
                            {
                                td = td + `<td class="text-center ${i} bg-light">${item[i]}</td>`;
                                 counter = counter + 1;
                            }
                            else if (counter < 3 && counter >= 0 && i.substr(0, 2) === "D_") {
                                td = td + `<td class="text-center ${i} bg-light">${item[i]}</td>`;
                                 counter = counter + 1;
                            }
                            else if (counter >= 3 && counter <= 5 && i.substr(0, 2) === "C_") {
                                td = td + `<td class="text-center ${i} bg-white">${item[i]}</td>`;
                                 if (counter===5) {
                                    counter = 0;
                                 }
                            }
                            else if (counter >= 3 && counter <= 5 && i.substr(0, 2) === "E_") {
                                td = td + `<td class="text-center ${i} bg-white">${item[i]}</td>`;
                                counter = counter + 1;
                                if (counter === 5) {
                                    counter = 0;
                                }
                            } 
                            else if (counter >= 3 && counter <= 5 && i.substr(0, 2) === "D_") {
                                td = td + `<td class="text-center ${i} bg-white">${item[i]}</td>`;
                                counter = counter + 1;
                                if (counter === 5) {
                                    counter = 0;
                                }
                            } 
                            else {
                                 td = td + `<td class="text-center ${i}">${item[i]}</td>`;
                                 counter = 0;
                            }

                            //if (i.substr(0, 2) === "C_") {
                            //    td = td + `<td class="text-center ${i} bg-light">${item[i]}</td>`;
                            //}
                            //else if (i.substr(0, 2) === "E_") {
                            //    td = td + `<td class="text-center ${i} bg-light">${item[i]}</td>`;
                            //}
                            //else if (i.substr(0, 2) === "D_") {
                            //    td = td + `<td class="text-center ${i} bg-light">${item[i]}</td>`;
                            //}
                            //else {
                            //    td = td + `<td class="text-center ${i}">${item[i]}</td>`;
                            //}

                        }
             
                        td = td + `</tr >`;
                        $(`#ejecution-table-body`).append(td);
                    })

                    $(`.IdCliente`).hide();
                    let client = $(`.Cliente`)[1];
                    let titleCliente = "Programa de Embalaje: "+$(client).text();

                    //Remover loader -> title
                    $(`#loader-container-1`).remove();

                    let h2 = `<h2>${titleCliente}</h2>`
                    $(`#container-title`).append(h2);

                    //Remove column table
                    $(`.Cliente`).hide();
                    $(`.IdDestino`).hide();
                    $(`.IdMarca`).hide();
                    $(`.IdCategoria`).hide();
                    $(`.IdEmbajale`).hide();

                    //Remover loader -> table
                    $(`#preloader-2`).remove();
                }
            })
            .catch(error => {
                console.log(error);
            });

            $('tbody').scroll(function (e) { //detect a scroll event on the tbody
                $('thead').css("left", -$("tbody").scrollLeft()); //fix the thead relative to the body scrolling
                $('thead th:nth-child(1)').css("left", $("tbody").scrollLeft()); //fix the first cell of the header
                $('tbody td:nth-child(1)').css("left", $("tbody").scrollLeft()); //fix the first column of tdbody
            });


        });
    </script>
}